<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body{
background:black;
color:white;
font-family:Arial;
text-align:center;
}

/* logo */
.logoText{
font-size:48px;
font-weight:bold;
margin:20px;
animation:logoFloat 3s ease-in-out infinite;
}
@keyframes logoFloat{
0%{transform:translateY(0)}
50%{transform:translateY(-6px)}
100%{transform:translateY(0)}
}

/* table */
table{
width:90%;
margin:auto;
border-collapse:collapse;
}
th,td{
border:1px solid #444;
padding:6px;
background:#ddd;
color:black;
}
tfoot td{
background:black;
color:white;
font-weight:bold;
}

/* input box small */
input{
width:90%;
padding:3px;
border:1px solid #999;
background:white;
text-align:center;
}

/* animation */
.profitNum{
color:#00ff88;
font-weight:bold;
animation:bounce .6s ease;
display:inline-block;
}
@keyframes bounce{
0%{transform:scale(1)}
50%{transform:scale(1.4)}
100%{transform:scale(1)}
}

.lossNum{
color:red;
font-weight:bold;
animation:blink 1s infinite;
}
@keyframes blink{
50%{opacity:0}
}

/* audit */
#auditBox{
display:none;
width:90%;
margin:auto;
background:#111;
border:1px solid #444;
padding:10px;
text-align:left;
font-size:13px;
}

button{
margin:5px;
padding:6px 12px;
}

.loginBox input{
width:160px;
}
</style>
</head>

<body>

<div class="logoText">D!CTATOR</div>
<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ö‡∏≠‡∏•</h2>

<div class="loginBox">
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>
</div>

<br>

<button onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô</button>
<button onclick="save()">üíæ Save</button>
<button onclick="toggleAudit()">Audit Log</button>

<table id="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏ó‡∏∏‡∏ô</th>
<th>‡∏Å‡∏≥‡πÑ‡∏£</th>
<th>-</th>
<th>‡∏£‡∏ß‡∏°</th>
<th>‡∏•‡∏ö‡∏ß‡∏±‡∏ô</th>
</tr>
</thead>
<tbody></tbody>

<tfoot>
<tr>
<td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
<td id="s1">0</td>
<td id="s2">0</td>
<td id="s3">0</td>
<td id="s4">0</td>
<td></td>
</tr>
</tfoot>
</table>

<h3>Audit Log</h3>
<div id="auditBox"></div>

<script type="module">

import {initializeApp} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import {getDatabase,ref,set,onValue} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
authDomain:"dictator-ball.firebaseapp.com",
databaseURL:"https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"dictator-ball"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const dataRef=ref(db,"table");
const auditRef=ref(db,"audit");

let admin=false;
let currentUser="guest";

const accounts={
"Pim888_":"dictator_888_pim",
"Yohan888_":"dictator_yohan_888",
"Jo888_":"Jo_dictator_888",
"Jwish888_":"dictator_Jwish888_",
"Joommeng_":"Joommeng888"
};

window.login=function(){
let u=user.value;
let p=pass.value;
if(accounts[u]===p){
admin=true;
currentUser=u;
log("LOGIN");
alert("Admin login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}else{
alert("‡∏ú‡∏¥‡∏î");
}
}

window.logout=function(){
admin=false;
log("LOGOUT");
alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö");
}

function log(msg){
let time=new Date().toLocaleString();
set(ref(db,"audit/"+Date.now()),`[${time}] ${currentUser} ‚Üí ${msg}`);
}

window.toggleAudit=function(){
auditBox.style.display=auditBox.style.display==="none"?"block":"none";
}

onValue(auditRef,s=>{
let txt="";
s.forEach(x=>txt+=x.val()+"\n");
auditBox.innerText=txt;
});

window.addRow=function(){
if(!admin)return alert("‡∏î‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß");
let tb=table.tBodies[0];
let r=tb.insertRow();
r.innerHTML=`
<td><input type=date></td>
<td><input value=0></td>
<td><input value=0></td>
<td><input value=0></td>
<td></td>
<td><button onclick="removeRow(this)">X</button></td>`;
}

window.removeRow=function(btn){
if(!admin)return;
btn.parentNode.parentNode.remove();
calc();
}

window.save=function(){
if(!admin)return alert("‡∏î‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß");
let rows=document.querySelectorAll("#table tbody tr");
let data=[];
rows.forEach(r=>{
data.push({
d:r.cells[0].children[0].value,
a:parseNum(r.cells[1].children[0].value),
b:parseNum(r.cells[2].children[0].value),
c:parseNum(r.cells[3].children[0].value)
});
});
set(dataRef,data);
log("SAVE TABLE");
alert("Saved");
}

onValue(dataRef,s=>{
let tb=table.tBodies[0];
tb.innerHTML="";
let d=s.val();
if(!d)return;
d.forEach(x=>{
let r=tb.insertRow();
r.innerHTML=`
<td><input type=date value="${x.d}"></td>
<td><input value="${fmt(x.a)}"></td>
<td><input class=profitNum value="${fmt(x.b)}"></td>
<td><input class=lossNum value="${fmt(x.c)}"></td>
<td></td>
<td><button onclick="removeRow(this)">X</button></td>`;
});
calc();
});

function parseNum(x){
return parseInt(x.toString().replace(/,/g,""))||0;
}

function fmt(x){
return x.toLocaleString();
}

function calc(){
let rows=document.querySelectorAll("#table tbody tr");
let s1=0,s2=0,s3=0,s4=0;
rows.forEach(r=>{
let a=parseNum(r.cells[1].children[0].value);
let b=parseNum(r.cells[2].children[0].value);
let c=parseNum(r.cells[3].children[0].value);
let t=a+b-c;
r.cells[4].innerText=fmt(t);
s1+=a; s2+=b; s3+=c; s4+=t;
});
s1El.innerText=fmt(s1);
s2El.innerText=fmt(s2);
s3El.innerText=fmt(s3);
s4El.innerText=fmt(s4);
}

document.addEventListener("input",calc);

const s1El=document.getElementById("s1");
const s2El=document.getElementById("s2");
const s3El=document.getElementById("s3");
const s4El=document.getElementById("s4");

</script>

</body>
</html>
