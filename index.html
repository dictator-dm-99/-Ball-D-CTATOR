<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body {
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
}

.logoText {
  font-size:60px;
  font-weight:bold;
  margin-top:20px;
}

.logoText span { color:red; }

table {
  width:90%;
  margin:auto;
  border-collapse:collapse;
  background:#111;
}

th, td {
  border:1px solid #555;
  padding:8px;
  background:#ddd;
  color:black;
}

button {
  padding:6px 10px;
  margin:5px;
}
</style>
</head>

<body>

<div class="logoText">D<span>!</span>CTATOR</div>
<h2>ตารางยอดบอล</h2>

<button onclick="addDay()">+ เพิ่มวัน</button>

<table id="table">
<thead>
<tr>
<th>วันที่</th>
<th>ทุน</th>
<th>กำไร</th>
<th>ลบ</th>
<th>รวม</th>
<th>ลบวัน</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
<td>รวมทั้งหมด</td>
<td id="sumทุน">0</td>
<td id="sumกำไร">0</td>
<td id="sumลบ">0</td>
<td id="sumรวม">0</td>
<td></td>
</tr>
</tfoot>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
  authDomain: "dictator-ball.firebaseapp.com",
  databaseURL: "https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dictator-ball",
  storageBucket: "dictator-ball.firebasestorage.app",
  messagingSenderId: "533340357926",
  appId: "1:533340357926:web:a1eb15b77c335a7a57ade7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db, "ball");

let data = [];

function save() {
  set(dbRef, data);
}

function render() {
  const tbody = document.querySelector("#table tbody");
  tbody.innerHTML = "";

  let sทุน=0, sกำไร=0, sลบ=0, sรวม=0;

  data.forEach((row,i)=>{
    const tr=document.createElement("tr");

    row.forEach((cell,j)=>{
      const td=document.createElement("td");
      const input=document.createElement("input");
      input.value=cell;
      input.oninput=()=>{
        data[i][j]=input.value;
        calc();
        save();
      };
      td.appendChild(input);
      tr.appendChild(td);
    });

    const total = (+row[1]||0)+(+row[2]||0)-(+row[3]||0);
    const tdTotal=document.createElement("td");
    tdTotal.textContent=total;
    tr.appendChild(tdTotal);

    const del=document.createElement("td");
    const btn=document.createElement("button");
    btn.textContent="X";
    btn.onclick=()=>{
      data.splice(i,1);
      save();
    };
    del.appendChild(btn);
    tr.appendChild(del);

    tbody.appendChild(tr);

    sทุน+=+row[1]||0;
    sกำไร+=+row[2]||0;
    sลบ+=+row[3]||0;
    sรวม+=total;
  });

  document.getElementById("sumทุน").textContent=sทุน;
  document.getElementById("sumกำไร").textContent=sกำไร;
  document.getElementById("sumลบ").textContent=sลบ;
  document.getElementById("sumรวม").textContent=sรวม;
}

function calc(){ render(); }

window.addDay=()=>{
  const today=new Date().toLocaleDateString();
  data.push([today,"0","0","0"]);
  save();
};

onValue(dbRef,snap=>{
  data=snap.val()||[];
  render();
});
</script>

</body>
</html>
