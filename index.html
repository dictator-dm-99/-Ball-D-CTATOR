<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body{background:black;color:white;font-family:Arial;text-align:center;margin:0;}
.logoText{font-size:48px;font-weight:bold;margin:20px;letter-spacing:3px;}
.logoText span{color:red;}

table{width:100%;border-collapse:collapse;}
th{background:#2b1a00;color:#ffcc66;padding:8px;border:1px solid #555;}
td{background:white;color:black;padding:6px;border:1px solid #555;vertical-align:top;}

input{width:95%;padding:4px;text-align:center;}
button{padding:4px 8px;margin:2px;cursor:pointer;}

.betterRow{
display:flex;
gap:4px;
margin-bottom:4px;
}

.betterRow input{width:33%;}
</style>
</head>

<body>

<div class="logoText">D<span>!</span>CTATOR</div>

<button onclick="addMatch()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏π‡πà</button>
<button onclick="save()">üíæ Save</button>

<table id="table">

<thead>
<tr>
<th>‡πÄ‡∏ß‡∏•‡∏≤</th>
<th>‡∏ó‡∏µ‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô</th>
<th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏≠‡∏•</th>
<th>‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô</th>
<th>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ó‡∏á</th>
<th>‡∏•‡∏ö</th>
</tr>
</thead>

<tbody></tbody>

<tfoot>
<tr>
<td colspan="4">‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÅ‡∏ó‡∏á</td>
<td id="sum">0</td>
<td></td>
</tr>
</tfoot>

</table>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig={
apiKey:"YOURKEY",
authDomain:"YOUR",
databaseURL:"YOUR",
projectId:"YOUR",
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const dataRef=ref(db,"matches");

function fmt(n){return Number(n).toLocaleString();}
function parse(n){return Number(String(n).replace(/,/g,""))||0;}

window.addMatch=function(){
let r=document.querySelector("#table tbody").insertRow();

r.innerHTML=`
<td><input type="time"></td>
<td><input></td>
<td><input></td>
<td><input></td>
<td>
<div class="betList"></div>
<button onclick="addBetter(this)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠</button>
</td>
<td><button onclick="removeRow(this)">X</button></td>
`;

}

window.addBetter=function(btn){
let box=btn.parentNode.querySelector(".betList");

let div=document.createElement("div");
div.className="betterRow";

div.innerHTML=`
<input placeholder="‡∏ä‡∏∑‡πà‡∏≠">
<input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå">
<input placeholder="‡∏¢‡∏≠‡∏î">
<button onclick="this.parentNode.remove();calc()">X</button>
`;

box.appendChild(div);
}

window.removeRow=function(b){
b.parentNode.parentNode.remove();
calc();
}

function calc(){
let total=0;

document.querySelectorAll(".betterRow").forEach(r=>{
let v=parse(r.children[2].value);
r.children[2].value=fmt(v);
total+=v;
});

sum.innerText=fmt(total);
}

document.addEventListener("input",calc);

window.save=function(){

let matches=[];

document.querySelectorAll("#table tbody tr").forEach(r=>{

let betters=[];

r.querySelectorAll(".betterRow").forEach(b=>{
betters.push({
name:b.children[0].value,
phone:b.children[1].value,
bet:parse(b.children[2].value)
});
});

matches.push({
time:r.cells[0].children[0].value,
home:r.cells[1].children[0].value,
price:r.cells[2].children[0].value,
away:r.cells[3].children[0].value,
betters:betters
});

});

set(dataRef,matches);
}

onValue(dataRef,s=>{
let data=s.val();
if(!data) return;

let tbody=document.querySelector("#table tbody");
tbody.innerHTML="";

data.forEach(m=>{

let r=tbody.insertRow();

r.innerHTML=`
<td><input type="time" value="${m.time}"></td>
<td><input value="${m.home}"></td>
<td><input value="${m.price}"></td>
<td><input value="${m.away}"></td>
<td>
<div class="betList"></div>
<button onclick="addBetter(this)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠</button>
</td>
<td><button onclick="removeRow(this)">X</button></td>
`;

let box=r.querySelector(".betList");

m.betters?.forEach(b=>{
let div=document.createElement("div");
div.className="betterRow";
div.innerHTML=`
<input value="${b.name}">
<input value="${b.phone}">
<input value="${fmt(b.bet)}">
<button onclick="this.parentNode.remove();calc()">X</button>
`;
box.appendChild(div);
});

});

calc();
});

</script>
</body>
</html>
