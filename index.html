<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body{
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
}

/* logo */
.logoText{
  font-size:48px;
  font-weight:bold;
  margin:20px;
}

/* ‡πÄ‡∏î‡πâ‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Å‡∏≥‡πÑ‡∏£ */
.profitNum{
  color:#00ff66;
  font-weight:bold;
  display:inline-block;
  animation:profitBounce 1s infinite alternate;
}

@keyframes profitBounce{
  from{ transform:scale(1); }
  to{ transform:scale(1.25); }
}

/* ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡∏ö */
.lossNum{
  color:red;
  font-weight:bold;
  animation:blink 1s infinite;
}

@keyframes blink{
  0%{opacity:1}
  50%{opacity:0.2}
  100%{opacity:1}
}

table{
  width:90%;
  margin:auto;
  border-collapse:collapse;
}

th{
  background:#111;
  color:white;
  padding:8px;
  border:1px solid #555;
}

td{
  background:white;
  color:black;
  padding:6px;
  border:1px solid #555;
}

tfoot td{
  background:black;
  color:white;
  font-weight:bold;
}

input{
  width:100%;
  border:none;
  text-align:center;
  background:white;
}

button{
  padding:6px 12px;
  margin:5px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="logoText">D<span style="color:red">!</span>CTATOR</div>
<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ö‡∏≠‡∏•</h2>

<button onclick="addDay()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô</button>
<button onclick="save()">üíæ Save</button>

<table id="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏ó‡∏∏‡∏ô</th>
<th>‡∏Å‡∏≥‡πÑ‡∏£</th>
<th>‡∏•‡∏ö</th>
<th>‡∏£‡∏ß‡∏°</th>
<th>‡∏•‡∏ö‡∏ß‡∏±‡∏ô</th>
</tr>
</thead>

<tbody></tbody>

<tfoot>
<tr>
<td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
<td id="sum‡∏ó‡∏∏‡∏ô">0</td>
<td id="sum‡∏Å‡∏≥‡πÑ‡∏£"><span class="profitNum">0</span></td>
<td id="sum‡∏•‡∏ö"><span class="lossNum">0</span></td>
<td id="sum‡∏£‡∏ß‡∏°">0</td>
<td></td>
</tr>
</tfoot>
</table>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
  authDomain: "dictator-ball.firebaseapp.com",
  databaseURL: "https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dictator-ball",
  storageBucket: "dictator-ball.appspot.com",
  messagingSenderId: "533340357926",
  appId: "1:533340357926:web:a1eb15b77c335a7a57ade7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dataRef = ref(db, "table");

function fmt(n){
  return Number(n).toLocaleString();
}

function parse(n){
  return Number(String(n).replace(/,/g,"")) || 0;
}

window.addDay = function(){
  let tbody = document.querySelector("#table tbody");
  let row = tbody.insertRow();

  row.innerHTML = `
  <td><input type="date"></td>
  <td><input value="0"></td>
  <td><input value="0"></td>
  <td><input value="0"></td>
  <td><span>0</span></td>
  <td><button onclick="removeRow(this)">X</button></td>
  `;

  calc();
}

window.removeRow = function(btn){
  btn.parentNode.parentNode.remove();
  calc();
}

function calc(){

  let rows = document.querySelectorAll("#table tbody tr");

  let sum‡∏ó‡∏∏‡∏ô=0,sum‡∏Å‡∏≥‡πÑ‡∏£=0,sum‡∏•‡∏ö=0,sum‡∏£‡∏ß‡∏°=0;

  rows.forEach(r=>{
    let ‡∏ó‡∏∏‡∏ô = parse(r.cells[1].children[0].value);
    let ‡∏Å‡∏≥‡πÑ‡∏£ = parse(r.cells[2].children[0].value);
    let ‡∏•‡∏ö = parse(r.cells[3].children[0].value);

    r.cells[1].children[0].value = fmt(‡∏ó‡∏∏‡∏ô);
    r.cells[2].children[0].value = fmt(‡∏Å‡∏≥‡πÑ‡∏£);
    r.cells[3].children[0].value = fmt(‡∏•‡∏ö);

    let ‡∏£‡∏ß‡∏° = ‡∏ó‡∏∏‡∏ô + ‡∏Å‡∏≥‡πÑ‡∏£ - ‡∏•‡∏ö;

    r.cells[4].innerHTML = `<span>${fmt(‡∏£‡∏ß‡∏°)}</span>`;

    sum‡∏ó‡∏∏‡∏ô += ‡∏ó‡∏∏‡∏ô;
    sum‡∏Å‡∏≥‡πÑ‡∏£ += ‡∏Å‡∏≥‡πÑ‡∏£;
    sum‡∏•‡∏ö += ‡∏•‡∏ö;
    sum‡∏£‡∏ß‡∏° += ‡∏£‡∏ß‡∏°;
  });

  document.getElementById("sum‡∏ó‡∏∏‡∏ô").innerText = fmt(sum‡∏ó‡∏∏‡∏ô);
  document.getElementById("sum‡∏Å‡∏≥‡πÑ‡∏£").innerHTML = `<span class="profitNum">${fmt(sum‡∏Å‡∏≥‡πÑ‡∏£)}</span>`;
  document.getElementById("sum‡∏•‡∏ö").innerHTML = `<span class="lossNum">${fmt(sum‡∏•‡∏ö)}</span>`;
  document.getElementById("sum‡∏£‡∏ß‡∏°").innerText = fmt(sum‡∏£‡∏ß‡∏°);
}

window.save = function(){

  let rows = document.querySelectorAll("#table tbody tr");
  let data = [];

  rows.forEach(r=>{
    data.push({
      date: r.cells[0].children[0].value,
      ‡∏ó‡∏∏‡∏ô: parse(r.cells[1].children[0].value),
      ‡∏Å‡∏≥‡πÑ‡∏£: parse(r.cells[2].children[0].value),
      ‡∏•‡∏ö: parse(r.cells[3].children[0].value)
    });
  });

  set(dataRef, data);
  alert("Saved!");
}

onValue(dataRef, snap=>{
  let data = snap.val();
  if(!data) return;

  let tbody = document.querySelector("#table tbody");
  tbody.innerHTML="";

  data.forEach(d=>{
    let row = tbody.insertRow();

    row.innerHTML = `
    <td><input type="date" value="${d.date}"></td>
    <td><input value="${fmt(d.‡∏ó‡∏∏‡∏ô)}"></td>
    <td><input value="${fmt(d.‡∏Å‡∏≥‡πÑ‡∏£)}"></td>
    <td><input value="${fmt(d.‡∏•‡∏ö)}"></td>
    <td><span>0</span></td>
    <td><button onclick="removeRow(this)">X</button></td>
    `;
  });

  calc();
});

document.addEventListener("input", calc);

</script>

</body>
</html>
