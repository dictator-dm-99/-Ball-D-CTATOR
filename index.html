<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body{
  background:#000;
  color:white;
  font-family:sans-serif;
  text-align:center;
}

h1{margin-top:20px;}

button{
  padding:6px 12px;
  margin:5px;
  cursor:pointer;
}

table{
  width:90%;
  margin:20px auto;
  border-collapse:collapse;
}

th{
  background:#111;
  color:white;
  padding:8px;
  border:1px solid #444;
}

td{
  background:white;
  color:black;
  padding:6px;
  border:1px solid #555;
}

/* ‡πÅ‡∏ñ‡∏ß‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
tfoot td{
  background:#000;
  color:white;
  font-weight:bold;
}

input{
  width:100%;
  border:none;
  text-align:center;
  background:white;
}
</style>
</head>

<body>

<h1>D!CTATOR</h1>
<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ö‡∏≠‡∏•</h2>

<button onclick="addDay()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô</button>
<button onclick="save()">üíæ Save</button>

<table id="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏ó‡∏∏‡∏ô</th>
<th>‡∏Å‡∏≥‡πÑ‡∏£</th>
<th>‡∏•‡∏ö</th>
<th>‡∏£‡∏ß‡∏°</th>
<th>‡∏•‡∏ö‡∏ß‡∏±‡∏ô</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

<tfoot>
<tr>
<td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
<td id="sum‡∏ó‡∏∏‡∏ô">0</td>
<td id="sum‡∏Å‡∏≥‡πÑ‡∏£">0</td>
<td id="sum‡∏•‡∏ö">0</td>
<td id="sum‡∏£‡∏ß‡∏°">0</td>
<td></td>
</tr>
</tfoot>

</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
  authDomain: "dictator-ball.firebaseapp.com",
  databaseURL: "https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dictator-ball",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.addDay = function(){
  const tbody = document.getElementById("tbody");
  const row = tbody.insertRow();

  row.innerHTML = `
  <td><input type="date"></td>
  <td><input type="number" value="0"></td>
  <td><input type="number" value="0"></td>
  <td><input type="number" value="0"></td>
  <td>0</td>
  <td><button onclick="this.closest('tr').remove(); calc()">X</button></td>
  `;

  row.querySelectorAll("input").forEach(i=>{
    i.oninput = calc;
  });

  calc();
};

window.calc = function(){
  let sum‡∏ó‡∏∏‡∏ô=0,sum‡∏Å‡∏≥‡πÑ‡∏£=0,sum‡∏•‡∏ö=0,sum‡∏£‡∏ß‡∏°=0;

  document.querySelectorAll("#tbody tr").forEach(r=>{
    let ‡∏ó‡∏∏‡∏ô=+r.cells[1].children[0].value;
    let ‡∏Å‡∏≥‡πÑ‡∏£=+r.cells[2].children[0].value;
    let ‡∏•‡∏ö=+r.cells[3].children[0].value;

    let ‡∏£‡∏ß‡∏°=‡∏ó‡∏∏‡∏ô+‡∏Å‡∏≥‡πÑ‡∏£-‡∏•‡∏ö;
    r.cells[4].innerText=‡∏£‡∏ß‡∏°;

    sum‡∏ó‡∏∏‡∏ô+=‡∏ó‡∏∏‡∏ô;
    sum‡∏Å‡∏≥‡πÑ‡∏£+=‡∏Å‡∏≥‡πÑ‡∏£;
    sum‡∏•‡∏ö+=‡∏•‡∏ö;
    sum‡∏£‡∏ß‡∏°+=‡∏£‡∏ß‡∏°;
  });

  document.getElementById("sum‡∏ó‡∏∏‡∏ô").innerText=sum‡∏ó‡∏∏‡∏ô;
  document.getElementById("sum‡∏Å‡∏≥‡πÑ‡∏£").innerText=sum‡∏Å‡∏≥‡πÑ‡∏£;
  document.getElementById("sum‡∏•‡∏ö").innerText=sum‡∏•‡∏ö;
  document.getElementById("sum‡∏£‡∏ß‡∏°").innerText=sum‡∏£‡∏ß‡∏°;
};

window.save = async function(){
  const data=[];
  document.querySelectorAll("#tbody tr").forEach(r=>{
    data.push({
      date:r.cells[0].children[0].value,
      ‡∏ó‡∏∏‡∏ô:r.cells[1].children[0].value,
      ‡∏Å‡∏≥‡πÑ‡∏£:r.cells[2].children[0].value,
      ‡∏•‡∏ö:r.cells[3].children[0].value
    });
  });

  await set(ref(db,"table"),data);
  alert("Saved!");
};

async function load(){
  const snap = await get(ref(db,"table"));
  if(!snap.exists()) return;

  snap.val().forEach(d=>{
    addDay();
    const r=document.querySelector("#tbody tr:last-child");
    r.cells[0].children[0].value=d.date;
    r.cells[1].children[0].value=d.‡∏ó‡∏∏‡∏ô;
    r.cells[2].children[0].value=d.‡∏Å‡∏≥‡πÑ‡∏£;
    r.cells[3].children[0].value=d.‡∏•‡∏ö;
  });

  calc();
}

load();
</script>

</body>
</html>
