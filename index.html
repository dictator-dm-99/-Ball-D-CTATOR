<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body {
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
}

.logoText {
  font-size:60px;
  font-weight:bold;
  margin-top:20px;
}

.logoText span { color:red; }

table {
  width:90%;
  margin:auto;
  border-collapse:collapse;
}

th {
  background:#111;
  color:white;
  padding:8px;
  border:1px solid #555;
}

td {
  background:white;
  padding:6px;
  border:1px solid #555;
}

input {
  width:100%;
  border:none;
  text-align:center;
  background:white;
}

button {
  padding:6px 10px;
  margin:5px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="logoText">D<span>!</span>CTATOR</div>
<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ö‡∏≠‡∏•</h2>

<button onclick="addDay()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô</button>
<button onclick="save()">üíæ Save</button>

<table id="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏ó‡∏∏‡∏ô</th>
<th>‡∏Å‡∏≥‡πÑ‡∏£</th>
<th>‡∏•‡∏ö</th>
<th>‡∏£‡∏ß‡∏°</th>
<th>‡∏•‡∏ö‡∏ß‡∏±‡∏ô</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
  authDomain: "dictator-ball.firebaseapp.com",
  databaseURL: "https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dictator-ball",
  storageBucket: "dictator-ball.firebasestorage.app",
  messagingSenderId: "533340357926",
  appId: "1:533340357926:web:a1eb15b77c335a7a57ade7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const tableRef = ref(db, "ball");

const tbody = document.querySelector("tbody");

function format(n){
  return Number(n||0).toLocaleString();
}

onValue(tableRef, snapshot => {
  tbody.innerHTML = "";

  let total‡∏ó‡∏∏‡∏ô=0, total‡∏Å‡∏≥‡πÑ‡∏£=0, total‡∏•‡∏ö=0, total‡∏£‡∏ß‡∏°=0;

  snapshot.forEach(child => {
    const d = child.val();

    total‡∏ó‡∏∏‡∏ô += Number(d.‡∏ó‡∏∏‡∏ô||0);
    total‡∏Å‡∏≥‡πÑ‡∏£ += Number(d.‡∏Å‡∏≥‡πÑ‡∏£||0);
    total‡∏•‡∏ö += Number(d.‡∏•‡∏ö||0);
    total‡∏£‡∏ß‡∏° += Number(d.‡∏£‡∏ß‡∏°||0);

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${d.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà}</td>
      <td>${format(d.‡∏ó‡∏∏‡∏ô)}</td>
      <td>${format(d.‡∏Å‡∏≥‡πÑ‡∏£)}</td>
      <td>${format(d.‡∏•‡∏ö)}</td>
      <td>${format(d.‡∏£‡∏ß‡∏°)}</td>
      <td><button onclick="del('${child.key}')">X</button></td>
    `;

    tbody.appendChild(tr);
  });

  // üî• ‡πÅ‡∏ñ‡∏ß‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  const sum = document.createElement("tr");
  sum.style.fontWeight="bold";
  sum.innerHTML = `
    <td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
    <td>${format(total‡∏ó‡∏∏‡∏ô)}</td>
    <td>${format(total‡∏Å‡∏≥‡πÑ‡∏£)}</td>
    <td>${format(total‡∏•‡∏ö)}</td>
    <td>${format(total‡∏£‡∏ß‡∏°)}</td>
    <td></td>
  `;
  tbody.appendChild(sum);
});

window.addRow = function(){
  const ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà = prompt("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");
  const ‡∏ó‡∏∏‡∏ô = prompt("‡∏ó‡∏∏‡∏ô");
  const ‡∏Å‡∏≥‡πÑ‡∏£ = prompt("‡∏Å‡∏≥‡πÑ‡∏£");
  const ‡∏•‡∏ö = prompt("‡∏•‡∏ö");

  const ‡∏£‡∏ß‡∏° = Number(‡∏ó‡∏∏‡∏ô||0) + Number(‡∏Å‡∏≥‡πÑ‡∏£||0) - Number(‡∏•‡∏ö||0);

  push(tableRef, {‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡∏ó‡∏∏‡∏ô, ‡∏Å‡∏≥‡πÑ‡∏£, ‡∏•‡∏ö, ‡∏£‡∏ß‡∏°});
}

window.del = function(key){
  remove(ref(db, "ball/"+key));
}
</script>

</body>
</html>
