<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>DICTATOR</title>

<style>
body{
  background:black;
  color:white;
  font-family:sans-serif;
  text-align:center;
}

.logo{
  font-size:60px;
  font-weight:bold;
  margin-top:20px;
  animation:shake 2s infinite;
}

@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-3px)}
  50%{transform:translateX(3px)}
  75%{transform:translateX(-3px)}
  100%{transform:translateX(0)}
}

table{
  width:90%;
  margin:auto;
  border-collapse:collapse;
}

th{
  background:#111;
  color:white;
  padding:8px;
  border:1px solid #555;
}

td{
  background:white;
  color:black;
  border:1px solid #555;
  padding:6px;
}

tfoot td{
  background:black;
  color:white;
  font-weight:bold;
}

input{
  width:100%;
  border:none;
  text-align:center;
  background:white;
}

button{
  margin:10px;
  padding:5px 12px;
}

.profit{
  color:limegreen;
  font-weight:bold;
  animation:pop 0.4s ease;
}

@keyframes pop{
  0%{transform:scale(1)}
  50%{transform:scale(1.3)}
  100%{transform:scale(1)}
}

.loss{
  color:red;
  font-weight:bold;
  animation:blink 1s infinite;
}

@keyframes blink{
  50%{opacity:0.2}
}
</style>
</head>

<body>

<div class="logo">D!CTATOR</div>
<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ö‡∏≠‡∏•</h2>

<button onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô</button>
<button onclick="save()">üíæ Save</button>

<table id="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏ó‡∏∏‡∏ô</th>
<th>‡∏Å‡∏≥‡πÑ‡∏£</th>
<th>‡∏•‡∏ö</th>
<th>‡∏£‡∏ß‡∏°</th>
<th>‡∏•‡∏ö‡∏ß‡∏±‡∏ô</th>
</tr>
</thead>
<tbody></tbody>

<tfoot>
<tr>
<td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
<td id="sum‡∏ó‡∏∏‡∏ô">0</td>
<td id="sum‡∏Å‡∏≥‡πÑ‡∏£">0</td>
<td id="sum‡∏•‡∏ö">0</td>
<td id="sum‡∏£‡∏ß‡∏°">0</td>
<td></td>
</tr>
</tfoot>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
 apiKey: "AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
 authDomain: "dictator-ball.firebaseapp.com",
 databaseURL: "https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId: "dictator-ball"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dataRef = ref(db, "rows");

window.addRow = function(){
 const tbody = document.querySelector("#table tbody");
 const r = tbody.insertRow();

 r.innerHTML = `
 <td><input type="date"></td>
 <td><input type="number" oninput="calc()"></td>
 <td><input type="number" oninput="calc()"></td>
 <td><input type="number" oninput="calc()"></td>
 <td class="result">0</td>
 <td><button onclick="delRow(this)">X</button></td>
 `;
}

window.delRow = function(btn){
 btn.parentNode.parentNode.remove();
 calc();
}

function fmt(n){
 return Number(n).toLocaleString();
}

window.calc = function(){
 let sum‡∏ó‡∏∏‡∏ô=0,sum‡∏Å‡∏≥‡πÑ‡∏£=0,sum‡∏•‡∏ö=0,sum‡∏£‡∏ß‡∏°=0;

 document.querySelectorAll("#table tbody tr").forEach(r=>{
  let t=+r.cells[1].firstChild.value||0;
  let g=+r.cells[2].firstChild.value||0;
  let l=+r.cells[3].firstChild.value||0;
  let total=t+g-l;

  let cell=r.cells[4];
  cell.innerText=fmt(total);
  cell.classList.remove("profit","loss");

  if(total>0) cell.classList.add("profit");
  if(total<0) cell.classList.add("loss");

  sum‡∏ó‡∏∏‡∏ô+=t;
  sum‡∏Å‡∏≥‡πÑ‡∏£+=g;
  sum‡∏•‡∏ö+=l;
  sum‡∏£‡∏ß‡∏°+=total;
 });

 document.getElementById("sum‡∏ó‡∏∏‡∏ô").innerText=fmt(sum‡∏ó‡∏∏‡∏ô);
 document.getElementById("sum‡∏Å‡∏≥‡πÑ‡∏£").innerText=fmt(sum‡∏Å‡∏≥‡πÑ‡∏£);
 document.getElementById("sum‡∏•‡∏ö").innerText=fmt(sum‡∏•‡∏ö);

 let totalCell=document.getElementById("sum‡∏£‡∏ß‡∏°");
 totalCell.innerText=fmt(sum‡∏£‡∏ß‡∏°);
 totalCell.classList.remove("profit","loss");
 if(sum‡∏£‡∏ß‡∏°>0) totalCell.classList.add("profit");
 if(sum‡∏£‡∏ß‡∏°<0) totalCell.classList.add("loss");
}

window.save = function(){
 const rows=[];
 document.querySelectorAll("#table tbody tr").forEach(r=>{
  rows.push({
   d:r.cells[0].firstChild.value,
   t:r.cells[1].firstChild.value,
   g:r.cells[2].firstChild.value,
   l:r.cells[3].firstChild.value
  });
 });
 set(dataRef,rows);
 alert("Saved!");
}

onValue(dataRef,snap=>{
 const data=snap.val()||[];
 const tbody=document.querySelector("#table tbody");
 tbody.innerHTML="";
 data.forEach(x=>{
  addRow();
  const r=tbody.lastChild;
  r.cells[0].firstChild.value=x.d;
  r.cells[1].firstChild.value=x.t;
  r.cells[2].firstChild.value=x.g;
  r.cells[3].firstChild.value=x.l;
 });
 calc();
});

</script>

</body>
</html>
