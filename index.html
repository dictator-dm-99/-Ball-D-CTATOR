<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body{
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
}

.logoText{
  font-size:48px;
  font-weight:bold;
  margin:20px;
}

table{
  width:90%;
  margin:auto;
  border-collapse:collapse;
}

th{
  background:#111;
  color:white;
  padding:8px;
  border:1px solid #555;
}

td{
  background:white;
  color:black;
  padding:6px;
  border:1px solid #555;
}

tfoot td{
  background:black;
  color:white;
  font-weight:bold;
}

input{
  width:100%;
  border:none;
  text-align:center;
  background:white;
}

button{
  padding:6px 12px;
  margin:5px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="logoText">D<span style="color:red">!</span>CTATOR</div>
<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ö‡∏≠‡∏•</h2>

<button onclick="addDay()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô</button>
<button onclick="save()">üíæ Save</button>

<table id="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏ó‡∏∏‡∏ô</th>
<th>‡∏Å‡∏≥‡πÑ‡∏£</th>
<th>‡∏•‡∏ö</th>
<th>‡∏£‡∏ß‡∏°</th>
<th>‡∏•‡∏ö‡∏ß‡∏±‡∏ô</th>
</tr>
</thead>

<tbody></tbody>

<tfoot>
<tr>
<td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
<td id="sum‡∏ó‡∏∏‡∏ô">0</td>
<td id="sum‡∏Å‡∏≥‡πÑ‡∏£">0</td>
<td id="sum‡∏•‡∏ö">0</td>
<td id="sum‡∏£‡∏ß‡∏°">0</td>
<td></td>
</tr>
</tfoot>

</table>

<script type="module">

// üî• Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
  authDomain: "dictator-ball.firebaseapp.com",
  databaseURL: "https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dictator-ball",
  storageBucket: "dictator-ball.appspot.com",
  messagingSenderId: "533340357926",
  appId: "1:533340357926:web:a1eb15b77c335a7a57ade7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dataRef = ref(db, "table");

window.addDay = function(){

  let tbody = document.querySelector("#table tbody");

  let row = tbody.insertRow();

  row.innerHTML = `
  <td><input type="date"></td>
  <td><input type="number" value="0"></td>
  <td><input type="number" value="0"></td>
  <td><input type="number" value="0"></td>
  <td>0</td>
  <td><button onclick="removeRow(this)">X</button></td>
  `;

  calc();
}

window.removeRow = function(btn){
  btn.parentNode.parentNode.remove();
  calc();
}

function calc(){

  let rows = document.querySelectorAll("#table tbody tr");

  let sum‡∏ó‡∏∏‡∏ô=0,sum‡∏Å‡∏≥‡πÑ‡∏£=0,sum‡∏•‡∏ö=0,sum‡∏£‡∏ß‡∏°=0;

  rows.forEach(r=>{
    let ‡∏ó‡∏∏‡∏ô = +r.cells[1].children[0].value;
    let ‡∏Å‡∏≥‡πÑ‡∏£ = +r.cells[2].children[0].value;
    let ‡∏•‡∏ö = +r.cells[3].children[0].value;

    let ‡∏£‡∏ß‡∏° = ‡∏ó‡∏∏‡∏ô + ‡∏Å‡∏≥‡πÑ‡∏£ - ‡∏•‡∏ö;

    r.cells[4].innerText = ‡∏£‡∏ß‡∏°.toLocaleString();

    sum‡∏ó‡∏∏‡∏ô += ‡∏ó‡∏∏‡∏ô;
    sum‡∏Å‡∏≥‡πÑ‡∏£ += ‡∏Å‡∏≥‡πÑ‡∏£;
    sum‡∏•‡∏ö += ‡∏•‡∏ö;
    sum‡∏£‡∏ß‡∏° += ‡∏£‡∏ß‡∏°;
  });

  document.getElementById("sum‡∏ó‡∏∏‡∏ô").innerText = sum‡∏ó‡∏∏‡∏ô.toLocaleString();
  document.getElementById("sum‡∏Å‡∏≥‡πÑ‡∏£").innerText = sum‡∏Å‡∏≥‡πÑ‡∏£.toLocaleString();
  document.getElementById("sum‡∏•‡∏ö").innerText = sum‡∏•‡∏ö.toLocaleString();
  document.getElementById("sum‡∏£‡∏ß‡∏°").innerText = sum‡∏£‡∏ß‡∏°.toLocaleString();
}

window.save = function(){

  let rows = document.querySelectorAll("#table tbody tr");
  let data = [];

  rows.forEach(r=>{
    data.push({
      date: r.cells[0].children[0].value,
      ‡∏ó‡∏∏‡∏ô: r.cells[1].children[0].value,
      ‡∏Å‡∏≥‡πÑ‡∏£: r.cells[2].children[0].value,
      ‡∏•‡∏ö: r.cells[3].children[0].value
    });
  });

  set(dataRef, data);
  alert("Saved!");
}

onValue(dataRef, snap=>{
  let data = snap.val();
  if(!data) return;

  let tbody = document.querySelector("#table tbody");
  tbody.innerHTML="";

  data.forEach(d=>{
    let row = tbody.insertRow();

    row.innerHTML = `
    <td><input type="date" value="${d.date}"></td>
    <td><input type="number" value="${d.‡∏ó‡∏∏‡∏ô}"></td>
    <td><input type="number" value="${d.‡∏Å‡∏≥‡πÑ‡∏£}"></td>
    <td><input type="number" value="${d.‡∏•‡∏ö}"></td>
    <td>0</td>
    <td><button onclick="removeRow(this)">X</button></td>
    `;
  });

  calc();
});

document.addEventListener("input", calc);

</script>

</body>
</html>
