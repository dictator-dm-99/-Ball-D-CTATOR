<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>D!CTATOR</title>

<style>
body {
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
}

.logoText {
  font-size:60px;
  font-weight:bold;
  margin-top:20px;
}

.logoText span { color:red; }

table {
  width:90%;
  margin:auto;
  border-collapse:collapse;
}

th {
  background:#111;
  color:white;
  padding:8px;
  border:1px solid #555;
}

td {
  background:white;
  padding:6px;
  border:1px solid #555;
}

tfoot td {
  color: red;
  font-weight: bold;
}

input {
  width:100%;
  border:none;
  text-align:center;
  background:white;
}

button {
  padding:6px 10px;
  margin:5px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="logoText">D<span>!</span>CTATOR</div>
<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ö‡∏≠‡∏•</h2>

<button onclick="addDay()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô</button>
<button onclick="save()">üíæ Save</button>

<table id="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏ó‡∏∏‡∏ô</th>
<th>‡∏Å‡∏≥‡πÑ‡∏£</th>
<th>‡∏•‡∏ö</th>
<th>‡∏£‡∏ß‡∏°</th>
<th>‡∏•‡∏ö‡∏ß‡∏±‡∏ô</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
<td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
<td id="sum‡∏ó‡∏∏‡∏ô">0</td>
<td id="sum‡∏Å‡∏≥‡πÑ‡∏£">0</td>
<td id="sum‡∏•‡∏ö">0</td>
<td id="sum‡∏£‡∏ß‡∏°">0</td>
<td></td>
</tr>
</tfoot>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZ0iBQX1uJz_gf23M6gn8yQ6S90lGYDOc",
  authDomain: "dictator-ball.firebaseapp.com",
  databaseURL: "https://dictator-ball-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dictator-ball",
  storageBucket: "dictator-ball.firebasestorage.app",
  messagingSenderId: "533340357926",
  appId: "1:533340357926:web:a1eb15b77c335a7a57ade7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db, "ball");

let data = [];

window.save = function() {
  set(dbRef, data);
};

window.addDay = function() {
  const today = new Date().toLocaleDateString();
  data.push([today,"0","0","0"]);
  render();
};

function render() {
  const tbody = document.querySelector("#table tbody");
  tbody.innerHTML = "";

  let s‡∏ó‡∏∏‡∏ô=0, s‡∏Å‡∏≥‡πÑ‡∏£=0, s‡∏•‡∏ö=0, s‡∏£‡∏ß‡∏°=0;

  data.forEach((row,i)=>{
    const tr=document.createElement("tr");

    row.forEach((cell,j)=>{
      const td=document.createElement("td");
      const input=document.createElement("input");
      input.value=cell;
      input.oninput=()=>{
        data[i][j]=input.value;
        render();
      };
      td.appendChild(input);
      tr.appendChild(td);
    });

    const total = (+row[1]||0)+(+row[2]||0)-(+row[3]||0);
    const tdTotal=document.createElement("td");
    tdTotal.textContent=total;
    tr.appendChild(tdTotal);

    const del=document.createElement("td");
    const btn=document.createElement("button");
    btn.textContent="X";
    btn.onclick=()=>{
      data.splice(i,1);
      render();
    };
    del.appendChild(btn);
    tr.appendChild(del);

    tbody.appendChild(tr);

    s‡∏ó‡∏∏‡∏ô+=+row[1]||0;
    s‡∏Å‡∏≥‡πÑ‡∏£+=+row[2]||0;
    s‡∏•‡∏ö+=+row[3]||0;
    s‡∏£‡∏ß‡∏°+=total;
  });

  document.getElementById("sum‡∏ó‡∏∏‡∏ô").textContent=s‡∏ó‡∏∏‡∏ô;
  document.getElementById("sum‡∏Å‡∏≥‡πÑ‡∏£").textContent=s‡∏Å‡∏≥‡πÑ‡∏£;
  document.getElementById("sum‡∏•‡∏ö").textContent=s‡∏•‡∏ö;
  document.getElementById("sum‡∏£‡∏ß‡∏°").textContent=s‡∏£‡∏ß‡∏°;
}

onValue(dbRef,snap=>{
  data=snap.val()||[];
  render();
});
</script>

</body>
</html>
